Segment Tree.

Time Complexity O(NlogM). Space Complexity O(logM). M is the length of array. N is the length of queries.